<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário de Tarefas</title>

    <link rel="stylesheet" href="/static/style.css" />
    
    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@5.11.5/main.global.min.js"></script>
</head>
<body>
    <div class="calendar-container">
        <h2>Calendário de Tarefas</h2>
        <p>Aqui você pode visualizar e adicionar suas tarefas diárias.</p>

        <div id="calendar" class="calendar"></div>

        <!-- Container para adicionar tarefas -->
        <div id="task-container" class="task-container" style="display: none">
            <h3>Tarefa para o dia <span id="task-day"></span></h3>
            <form id="task-form" class="task-form">
                <input type="text" id="task-input" placeholder="Digite sua tarefa..." required />
                <button type="submit">Adicionar</button>
            </form>
            <div id="task-list" class="task-list"></div>
        </div>

        <!-- Botão para voltar ao Dashboard -->
        <button onclick="window.location.href='/dashboard'" class="back-to-dashboard">
            Voltar para o Dashboard
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var taskContainer = document.getElementById('task-container');
            var taskDay = document.getElementById('task-day');
            var taskInput = document.getElementById('task-input');
            var taskList = document.getElementById('task-list');
            var taskForm = document.getElementById('task-form');
            
            // Lista local de eventos
            var localEvents = [];

            // Inicializando o FullCalendar com Google Calendar e eventos locais
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                editable: true, 
                selectable: true, 
                googleCalendarApiKey: 'AIzaSyAodsmzUCeJhoA8dS3AMg_4mkHy_ZKYcSY',
                events: [
                    { googleCalendarId: 'fernandogabrielcarriju@gmail.com' }
                ],
                eventSources: [
                    {
                        googleCalendarId: 'fernandogabrielcarriju@gmail.com',
                        className: 'google-event' 
                    },
                    {
                        events: localEvents,
                        className: 'local-event'
                    }
                ],
                dateClick: function(info) {
                    taskDay.textContent = info.dateStr;
                    taskContainer.style.display = 'block';
                    taskInput.value = '';
                    taskList.innerHTML = '';

                    var tasksForDate = localEvents.filter(e => e.start === info.dateStr);
                    tasksForDate.forEach(t => {
                        var taskItem = document.createElement('div');
                        taskItem.textContent = t.title;
                        taskList.appendChild(taskItem);
                    });

                    taskForm.dataset.selectedDate = info.dateStr;
                }
            });

            calendar.render();

            // Adicionar nova tarefa localmente
            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();
                var selectedDate = taskForm.dataset.selectedDate;
                if (!selectedDate) return;

                var taskText = taskInput.value.trim();
                if (taskText !== "") {
                    var newEvent = {
                        title: taskText,
                        start: selectedDate,
                        allDay: true
                    };

                    localEvents.push(newEvent);
                    calendar.addEvent(newEvent);

                    var taskItem = document.createElement('div');
                    taskItem.textContent = taskText;
                    taskList.appendChild(taskItem);

                    taskInput.value = "";
                }
            });
        });
    </script>
</body>
</html>
