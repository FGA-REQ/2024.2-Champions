<!--<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário de Tarefas</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@5.11.5/main.global.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div class="calendar-container">
        <h2>Calendário de Tarefas</h2>
		<p>Aqui você pode visualizar e adicionar suas tarefas diárias.</p>
		
        <button id="google-login">Conectar ao Google Calendar</button>
        <button id="google-logout" style="display: none;">Desconectar</button>
		
        <div id="calendar" class="calendar"></div>
        <div id="task-container" class="task-container" style="display: none">
            <h3>Tarefa para o dia <span id="task-day"></span></h3>
            <form id="task-form" class="task-form">
                <input type="text" id="task-input" placeholder="Digite sua tarefa..." required />
                <button type="submit">Adicionar</button>
            </form>
            <div id="task-list" class="task-list"></div>
        </div>
        <button onclick="window.location.href='/dashboard'" class="back-to-dashboard">Voltar para o Dashboard</button>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
			var googleLoginBtn = document.getElementById('google-login');
            var googleLogoutBtn = document.getElementById('google-logout');
            var taskContainer = document.getElementById('task-container');
            var taskDay = document.getElementById('task-day');
            var taskInput = document.getElementById('task-input');
            var taskList = document.getElementById('task-list');
            var taskForm = document.getElementById('task-form');
			
			var CLIENT_ID = '713362341416-2mqdtd6mt1re2r8rl5te87ijk8u0ohng.apps.googleusercontent.com';
            var API_KEY = 'AIzaSyAodsmzUCeJhoA8dS3AMg_4mkHy_ZKYcSY';
            var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
            var SCOPES = "https://www.googleapis.com/auth/calendar";
            var gapiLoaded = false;
			
            var localEvents = [];

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                selectable: true,
                editable: true,
                events: localEvents,
                dateClick: function(info) {
                    taskDay.textContent = info.dateStr;
                    taskContainer.style.display = 'block';
                    taskInput.value = '';
                    taskList.innerHTML = '';
					
                    var tasksForDate = localEvents.filter(e => e.start === info.dateStr);
                    tasksForDate.forEach(t => addTaskToList(t));
                    taskForm.dataset.selectedDate = info.dateStr;
                }
            });
            calendar.render();
			
			function handleClientLoad() {
                gapi.load('client', () => {
                    gapi.client.init({
                        apiKey: API_KEY,
                        clientId: CLIENT_ID,
                        discoveryDocs: DISCOVERY_DOCS,
                        scope: SCOPES
                    }).then(() => {
                        gapi.auth2.getAuthInstance().signIn();
                    }).catch(error => console.error("Erro na inicialização do cliente:", error));
                });

            }

            function initClient() {
                gapi.client.init({
                    apiKey: "AIzaSyAodsmzUCeJhoA8dS3AMg_4mkHy_ZKYcSY",
                    clientId: "713362341416-2mqdtd6mt1re2r8rl5te87ijk8u0ohng.apps.googleusercontent.com",
                    discoveryDocs: DISCOVERY_DOCS,
                    scope: SCOPES
                }).then(function () {
                    gapiLoaded = true;
                    var GoogleAuth = gapi.auth2.getAuthInstance();
                    updateSigninStatus(GoogleAuth.isSignedIn.get());
                    GoogleAuth.isSignedIn.listen(updateSigninStatus);
                });
            }

            function updateSigninStatus(isSignedIn) {
                if (isSignedIn) {
                    googleLoginBtn.style.display = 'none';
                    googleLogoutBtn.style.display = 'block';
                    listUpcomingEvents();
                } else {
                    googleLoginBtn.style.display = 'block';
                    googleLogoutBtn.style.display = 'none';
                    calendar.getEvents().forEach(event => event.remove());
                }
            }
			
			function listUpcomingEvents() {
                gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': (new Date()).toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 10,
                    'orderBy': 'startTime'
                }).then(function(response) {
                    response.result.items.forEach(event => {
                        var newEvent = {
                            title: event.summary,
                            start: event.start.dateTime || event.start.date,
                            allDay: !event.start.dateTime
                        };
                        calendar.addEvent(newEvent);
                    });
                });
            }

            googleLoginBtn.onclick = function() {
                if (!gapiLoaded) {
                    handleClientLoad();  // Tenta carregar a API antes
                }
                gapi.auth2.getAuthInstance().signIn();
            };

            googleLogoutBtn.onclick = function() {
                gapi.auth2.getAuthInstance().signOut().then(() => {
                    updateSigninStatus(false);
                });
            };

            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();
                var selectedDate = taskForm.dataset.selectedDate;
                if (!selectedDate) return;

                var taskText = taskInput.value.trim();
                if (taskText !== "") {
                    var newEvent = { title: taskText, start: selectedDate, allDay: true };
                    localEvents.push(newEvent);
                    calendar.addEvent(newEvent);
                    var taskItem = document.createElement('div');
                    taskItem.textContent = taskText;
                    taskList.appendChild(taskItem);
                    taskInput.value = "";
                }
            });
        });
    </script>
</body>
</html>-->


<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário de Tarefas</title>

    <link rel="stylesheet" href="/static/style.css" />
    
    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@5.11.5/main.global.min.js"></script>
    
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>

    <style>
      body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        height: 100vh;
        background: linear-gradient(to right, #eef2f3, #8e9eab);
        padding-top: 60px; /* Para garantir que o conteúdo não fique escondido atrás da barra fixa */
      }

      /* Barra superior fixa */
      .top-bar {
        width: 100%;
        background: linear-gradient(to right, #526cfe, #4052c4);
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 20px;
        font-weight: bold;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
      }
      .top-bar .site-name {
        font-size: 24px;
        margin-left: 20px;
      }
      .top-bar .info {
        font-size: 14px;
        margin-right: 20px;
        text-align: right;
      }

      /* Estilo do container */
      .calendar-container {
        background: #f4f4f4;
        width: 60%;
        max-width: 800px;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 4px solid transparent;
        background-clip: padding-box;
        position: relative;
        margin-top: 80px; /* Ajuste para dar espaço depois da barra fixa */
        text-align: center;
      }
      .calendar-container::before {
        content: "";
        position: absolute;
        top: -6px;
        left: -6px;
        right: -6px;
        bottom: -6px;
        border-radius: 15px;
        border: 3px solid #526cfe;
        z-index: -1;
      }

      h2 {
        color: #526cfe;
        font-size: 30px;
        margin-bottom: 20px;
      }

      button {
        background: linear-gradient(to right, #526cfe, #4052c4);
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px 0;
        transition: background 0.3s ease, transform 0.2s ease;
      }
      button:hover {
        background: linear-gradient(to right, #4052c4, #526cfe);
        transform: translateY(-3px);
      }

      .back-to-dashboard {
        background: #6c757d;
        margin-top: 20px;
      }

      #task-container {
        margin-top: 20px;
        display: none;
      }

      #task-container h3 {
        font-size: 20px;
        color: #526cfe;
      }

      .task-form {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
      }

      .task-form input {
        width: 80%;
        padding: 10px;
        font-size: 16px;
        border-radius: 8px;
        border: 1px solid #ccc;
      }

      .task-form button {
        width: 18%;
      }

      .task-list {
        margin-top: 20px;
        padding: 10px;
        background: #eef2f3;
        border-radius: 8px;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
      }

      .task-list div {
        padding: 5px;
        background: #fff;
        border-radius: 4px;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <!-- Barra superior -->
    <div class="top-bar">
      <div class="site-name">Média Mestre</div>
      <div class="info">Este site trata-se apenas de um simulador de médias.</div>
    </div>

    <!-- Container principal -->
    <div class="calendar-container">
      <h2>Calendário de Tarefas</h2>
      <p>Aqui você pode visualizar e adicionar suas tarefas diárias.</p>

      <!-- Botões de autenticação Google -->
      <button id="google-login">Conectar ao Google Calendar</button>
      <button id="google-logout" style="display: none;">Desconectar</button>

      <!-- FullCalendar -->
      <div id="calendar" class="calendar"></div>

      <!-- Container para adicionar tarefas locais -->
      <div id="task-container">
        <h3>Tarefa para o dia <span id="task-day"></span></h3>
        <form id="task-form" class="task-form">
          <input type="text" id="task-input" placeholder="Digite sua tarefa..." required />
          <button type="submit">Adicionar</button>
        </form>
        <div id="task-list" class="task-list"></div>
      </div>

      <!-- Botão para voltar ao Dashboard -->
      <button onclick="window.location.href='/dashboard'" class="back-to-dashboard">
        Voltar para o Dashboard
      </button>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        handleClientLoad(); // Adicionado para carregar a API ao iniciar a página
      });

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var googleLoginBtn = document.getElementById('google-login');
        var googleLogoutBtn = document.getElementById('google-logout');
        var taskContainer = document.getElementById('task-container');
        var taskDay = document.getElementById('task-day');
        var taskInput = document.getElementById('task-input');
        var taskList = document.getElementById('task-list');
        var taskForm = document.getElementById('task-form');
        
        var CLIENT_ID = '713362341416-2mqdtd6mt1re2r8rl5te87ijk8u0ohng.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyAodsmzUCeJhoA8dS3AMg_4mkHy_ZKYcSY';
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        var SCOPES = "https://www.googleapis.com/auth/calendar";
        var gapiLoaded = false;

        var localEvents = [];

        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'pt-br',
          selectable: true,
          editable: true,
          eventSources: [
            {
              events: localEvents,
              className: 'local-event'
            }
          ],
          dateClick: function(info) {
            taskDay.textContent = info.dateStr;
            taskContainer.style.display = 'block';
            taskInput.value = '';
            taskList.innerHTML = '';
            
            var tasksForDate = localEvents.filter(e => e.start === info.dateStr);
            tasksForDate.forEach(t => {
              var taskItem = document.createElement('div');
              taskItem.textContent = t.title;
              taskList.appendChild(taskItem);
            });

            taskForm.dataset.selectedDate = info.dateStr;
          }
        });
        calendar.render();

        function handleClientLoad() {
          gapi.load('client', () => {
            gapi.client.init({
              apiKey: API_KEY,
              clientId: CLIENT_ID,
              discoveryDocs: DISCOVERY_DOCS,
              scope: SCOPES
            }).then(() => {
              gapi.auth2.getAuthInstance().signIn();
            }).catch(error => console.error("Erro na inicialização do cliente:", error));
          });
        }

        googleLoginBtn.onclick = function() {
          if (!gapiLoaded) {
            handleClientLoad();  // Tenta carregar a API antes
          }
          gapi.auth2.getAuthInstance().signIn();
        };

            googleLogoutBtn.onclick = function() {
                gapi.auth2.getAuthInstance().signOut().then(() => {
                    updateSigninStatus(false);
                });
            };
			
            function addTaskToList(task) {
                var taskItem = document.createElement('div');
                taskItem.innerHTML = `<span>${task.title}</span>
                    <button onclick="editTask('${task.title}', '${task.start}')">Editar</button>
                    <button onclick="deleteTask('${task.title}', '${task.start}')">Excluir</button>`;
                taskList.appendChild(taskItem);
            }

            taskForm.addEventListener('submit', function(event) {
                event.preventDefault();
                var selectedDate = taskForm.dataset.selectedDate;
                if (!selectedDate) return;
                var taskText = taskInput.value.trim();
                if (taskText !== "") {
                    var newEvent = { title: taskText, start: selectedDate, allDay: true };
                    localEvents.push(newEvent);
                    calendar.addEvent(newEvent);
                    addTaskToList(newEvent);
                    taskInput.value = "";
                }
            });

            window.editTask = function(title, date) {
                var newTitle = prompt("Editar tarefa:", title);
                if (newTitle) {
                    localEvents = localEvents.map(event =>
                        event.title === title && event.start === date ? { ...event, title: newTitle } : event
                    );
                    calendar.getEvents().forEach(event => {
                        if (event.title === title && event.startStr === date) {
                            event.remove();
                            calendar.addEvent({ title: newTitle, start: date, allDay: true });
                        }
                    });
                    taskContainer.style.display = 'none';
                }
            }

            window.deleteTask = function(title, date) {
                if (confirm("Tem certeza que deseja excluir esta tarefa?")) {
                    localEvents = localEvents.filter(event => !(event.title === title && event.start === date));
                    calendar.getEvents().forEach(event => {
                        if (event.title === title && event.startStr === date) {
                            event.remove();
                        }
                    });
                    taskContainer.style.display = 'none';
                }
            }
        });
    </script>
  </body>
</html>
